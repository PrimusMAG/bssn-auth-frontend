<div class="users-page">
  <!-- Filters -->
  <div class="card">
    <div class="card-head">
      <div class="head-left">
        <span class="head-ico">⎇</span>
        <span class="head-title">Filters</span>
      </div>
    </div>

    <div class="card-body">
      <div class="filters-grid">
        <div class="field">
          <label>Name</label>
          <input [(ngModel)]="fName" placeholder="Search by name..." />
        </div>

        <div class="field">
          <label>Username</label>
          <input [(ngModel)]="fUsername" placeholder="Search by username..." />
        </div>

        <div class="field">
          <label>Role</label>
          <select [(ngModel)]="fRole">
            <option *ngFor="let r of roleOptions" [value]="r">
              {{ r === 'ALL' ? 'All Roles' : r }}
            </option>
          </select>
        </div>

        <div class="field">
          <label>Active Status</label>
          <select [(ngModel)]="fActive">
            <option value="ALL">All</option>
            <option value="ACTIVE">Active</option>
            <option value="INACTIVE">Inactive</option>
          </select>
        </div>

        <div class="field">
          <label>Verified</label>
          <select [(ngModel)]="fVerified">
            <option value="ALL">All</option>
            <option value="VERIFIED">Verified</option>
            <option value="UNVERIFIED">Unverified</option>
          </select>
        </div>
      </div>

      <div class="actions">
        <button
          class="btn primary"
          type="button"
          (click)="applyFilters()"
          [disabled]="loading"
        >
          Apply Filters
        </button>

        <button class="btn" type="button" (click)="resetFilters()" [disabled]="loading">
          <span class="btn-ico">↻</span>
          Reset
        </button>
      </div>

      <div *ngIf="loading" class="hint">Loading...</div>
      <div *ngIf="errorMsg" class="hint warn">{{ errorMsg }}</div>
    </div>
  </div>

  <!-- Table -->
  <div class="card">
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>USERNAME</th>
            <th>NAME</th>
            <th>ROLES</th>
            <th>CREATED AT</th>
            <th class="th-actions">ACTIONS</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let u of users; trackBy: trackById">
            <!-- USERNAME + (status & verified) -->
            <td>
              <div class="cell-stack">
                <div class="primary mono">{{ u.username }}</div>
                <div class="sub">
                  <span class="badge" [class.green]="u.isActive" [class.gray]="!u.isActive">
                    {{ u.isActive ? 'Active' : 'Inactive' }}
                  </span>

                  <span class="badge" [class.blue]="u.isVerified" [class.gray]="!u.isVerified">
                    {{ u.isVerified ? 'Verified' : 'Unverified' }}
                  </span>
                </div>
              </div>
            </td>

            <!-- NAME + email -->
            <td>
              <div class="cell-stack">
                <div class="primary">{{ u.name }}</div>
                <div class="sub muted">{{ u.email }}</div>
              </div>
            </td>

            <!-- ROLES -->
            <td>
              <span class="badge role" *ngFor="let r of u.roles">{{ r }}</span>
            </td>

            <!-- CREATED AT -->
            <td class="muted">{{ u.createdAt | date: 'd MMM y, HH.mm' }}</td>

            <!-- ACTIONS -->
            <td class="td-actions">
              <button type="button" class="icon-btn" (click)="editUser(u)" title="Edit">✎</button>
            </td>
          </tr>

          <tr *ngIf="!loading && users.length === 0">
            <td colspan="5" class="empty">No users found.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pager" *ngIf="pagination">
      <div class="pager-left">
        Page {{ pagination.page }} / {{ pagination.totalPages }}
        <span class="dot">•</span>
        Total {{ pagination.totalItems }} users
      </div>

      <div class="pager-right">
        <button
          class="pager-btn"
          type="button"
          (click)="prevPage()"
          [disabled]="loading || !pagination.hasPrevPage"
        >
          Prev
        </button>
        <button
          class="pager-btn"
          type="button"
          (click)="nextPage()"
          [disabled]="loading || !pagination.hasNextPage"
        >
          Next
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ===================== MODAL: EDIT USER ===================== -->
<div class="modal-backdrop" *ngIf="showEditModal">
  <div class="modal">
    <div class="modal-head">
      <h3>Ubah Data User</h3>
      <button type="button" class="icon-close" (click)="closeEditModal()">✕</button>
    </div>

    <div class="modal-body">
      <div class="grid-2">
        <div class="field">
          <label>Email</label>
          <input [(ngModel)]="editModel.email" name="editEmail" placeholder="user@mail.com" />
        </div>

        <div class="field">
          <label>Name</label>
          <input [(ngModel)]="editModel.name" name="editName" placeholder="Nama user" />
        </div>
      </div>

      <div class="divider"></div>

      <div class="section-title">Status</div>
      <div class="toggle-grid">
        <label class="toggle-card">
          <input type="checkbox" [(ngModel)]="editModel.isActive" name="editActive" />
          <span class="toggle-text">
            <span class="toggle-label">Active</span>
            <span class="toggle-desc">User bisa login dan akses</span>
          </span>
        </label>

        <label class="toggle-card">
          <input type="checkbox" [(ngModel)]="editModel.isVerified" name="editVerified" />
          <span class="toggle-text">
            <span class="toggle-label">Verified</span>
            <span class="toggle-desc">Akun sudah terverifikasi</span>
          </span>
        </label>
      </div>

      <div class="divider"></div>

      <div class="section-title">Roles</div>
      <div class="role-grid">
        <label class="role-card">
          <input type="checkbox" [(ngModel)]="editModel.roles.USER" name="roleUSER" />
          <span class="role-text">
            <span class="role-name">USER</span>
            <span class="role-desc">Akses standard</span>
          </span>
        </label>

        <label class="role-card">
          <input type="checkbox" [(ngModel)]="editModel.roles.ADMIN" name="roleADMIN" />
          <span class="role-text">
            <span class="role-name">ADMIN</span>
            <span class="role-desc">Kelola user & sistem</span>
          </span>
        </label>
      </div>

      <small class="error" *ngIf="editError">{{ editError }}</small>

      <div class="modal-actions">
        <button type="button" class="btn secondary" (click)="closeEditModal()" [disabled]="loading">
          Batal
        </button>
        <button type="button" class="btn primary" (click)="saveEditUser()" [disabled]="loading">
          Simpan
        </button>
      </div>
    </div>
  </div>
</div>
